@model TinhNguyenXanh.DTOs.OrganizationDTO

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Chi tiết tổ chức";
}

<style>
    :root {
        --primary-color: #16a34a;
        --primary-hover: #15803d;
        --accent-light: #f0fdf4;
        --text-dark: #0f172a;
        --text-muted: #64748b;
        --border-color: #e5e7eb;
        --bg-light: #ffffff;
        --star-color: #fbbf24;
    }

    .org-detail-container {
        background: linear-gradient(to bottom, #f9fafb 0%, #ffffff 100%);
        min-height: 100vh;
        padding: 3rem 0;
    }

    /* ===== HEADER ===== */
    .detail-header {
        background: white;
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 1.25rem 1.5rem;
        margin-bottom: 2rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
    }

    .detail-header h6 {
        color: var(--text-dark);
        font-size: 1.1rem;
        margin: 0;
        font-weight: 600;
    }

    /* ===== MAIN CARD ===== */
    .org-main-card {
        background: white;
        border: 1px solid var(--border-color);
        border-radius: 16px;
        overflow: hidden;
        margin-bottom: 1.5rem;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        transition: all 0.3s ease;
    }

    .org-main-card:hover {
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
    }

    .org-image-detail {
        width: 100%;
        height: 280px;
        object-fit: cover;
        background: var(--accent-light);
    }

    .org-detail-content {
        padding: 2rem;
    }

    .org-detail-content h4 {
        color: var(--primary-color);
        font-size: 1.75rem;
        font-weight: 700;
        margin-bottom: 1.5rem;
    }

    .detail-info-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: var(--text-muted);
        font-size: 1rem;
        margin-bottom: 1rem;
    }

    .detail-info-item i {
        color: var(--primary-color);
        font-size: 1.1rem;
        min-width: 20px;
    }

    .detail-info-item a {
        color: var(--primary-color);
        text-decoration: none;
        font-weight: 500;
    }

    .detail-info-item a:hover {
        text-decoration: underline;
    }

    /* ===== BADGES ===== */
    .verify-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
        padding: 0.375rem 0.875rem;
        border-radius: 8px;
        font-size: 0.875rem;
        font-weight: 600;
    }

    .verify-badge.verified {
        background: #dcfce7;
        color: #166534;
    }

    .verify-badge.unverified {
        background: #f3f4f6;
        color: #6b7280;
    }

    /* ===== INFO CARDS ===== */
    .info-card {
        background: white;
        border: 1px solid var(--border-color);
        border-radius: 16px;
        padding: 2rem;
        margin-bottom: 1.5rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        transition: all 0.3s ease;
    }

    .info-card:hover {
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        transform: translateY(-2px);
    }

    .info-card h6 {
        color: var(--text-dark);
        font-size: 1.25rem;
        font-weight: 700;
        margin-bottom: 1.25rem;
        padding-bottom: 0.75rem;
        border-bottom: 2px solid var(--primary-color);
        display: inline-block;
    }

    .info-card p {
        color: var(--text-muted);
        line-height: 1.8;
        margin-bottom: 0.75rem;
    }

    .info-card p:last-child {
        margin-bottom: 0;
    }

    /* ===== BUTTONS ===== */
    .btn-document {
        background: var(--primary-color);
        color: white;
        border: none;
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        font-weight: 600;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }

    .btn-document:hover {
        background: var(--primary-hover);
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(22, 163, 74, 0.3);
    }

    .btn-back {
        background: white;
        color: var(--primary-color);
        border: 2px solid var(--primary-color);
        padding: 0.625rem 1.5rem;
        border-radius: 8px;
        font-weight: 600;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-block;
    }

    .btn-back:hover {
        background: var(--primary-color);
        color: white;
        transform: translateX(-4px);
    }

    /* ===== RATING SECTION ===== */
    .rating-summary {
        background: linear-gradient(135deg, #f0fdf4 0%, #ffffff 100%);
        border: 2px solid var(--primary-color);
        border-radius: 16px;
        padding: 2.5rem 2rem;
        text-align: center;
        margin-bottom: 2.5rem;
    }

    .rating-number {
        font-size: 4rem;
        font-weight: 800;
        color: var(--primary-color);
        line-height: 1;
        margin-bottom: 0.75rem;
    }

    .rating-stars {
        font-size: 1.75rem;
        color: var(--star-color);
        margin-bottom: 0.75rem;
        letter-spacing: 0.25rem;
    }

    .rating-count {
        color: var(--text-muted);
        font-size: 1rem;
        font-weight: 500;
    }

    /* ===== REVIEW FORM ===== */
    .review-form-card {
        background: #f9fafb;
        border: 2px dashed var(--border-color);
        border-radius: 16px;
        padding: 2rem;
        margin-bottom: 2.5rem;
        transition: all 0.3s ease;
    }

    .review-form-card:hover {
        border-color: var(--primary-color);
        background: white;
        box-shadow: 0 4px 12px rgba(22, 163, 74, 0.1);
    }

    .star-rating {
        display: flex;
        flex-direction: row-reverse;
        justify-content: flex-end;
        gap: 0.5rem;
        margin-bottom: 1.5rem;
    }

    .star-rating input {
        display: none;
    }

    .star-rating label {
        font-size: 2.5rem;
        color: #d1d5db;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .star-rating label:hover,
    .star-rating label:hover ~ label,
    .star-rating input:checked ~ label {
        color: var(--star-color);
        transform: scale(1.1);
    }

    .review-textarea {
        width: 100%;
        min-height: 140px;
        padding: 1rem;
        border: 2px solid var(--border-color);
        border-radius: 12px;
        font-size: 1rem;
        font-family: inherit;
        resize: vertical;
        transition: all 0.3s ease;
    }

    .review-textarea:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 4px rgba(22, 163, 74, 0.1);
    }

    .btn-submit-review {
        background: var(--primary-color);
        color: white;
        border: none;
        padding: 0.875rem 2rem;
        border-radius: 10px;
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }

    .btn-submit-review:hover {
        background: var(--primary-hover);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(22, 163, 74, 0.3);
    }

    /* ===== REVIEW ITEMS ===== */
    .review-item {
        background: white;
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 1.25rem;
        transition: all 0.3s ease;
    }

    .review-item:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        border-color: var(--primary-color);
    }

    .review-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 1rem;
    }

    .reviewer-info {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .reviewer-avatar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        object-fit: cover;
        border: 2px solid var(--primary-color);
    }

    .reviewer-placeholder {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: var(--primary-color);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 1.25rem;
    }

    .reviewer-details h6 {
        margin: 0 0 0.25rem 0;
        color: var(--text-dark);
        font-weight: 600;
        font-size: 1rem;
    }

    .review-stars {
        color: var(--star-color);
        font-size: 1rem;
        letter-spacing: 0.1rem;
    }

    .review-date {
        color: var(--text-muted);
        font-size: 0.875rem;
        font-weight: 500;
    }

    .review-text {
        color: var(--text-dark);
        line-height: 1.7;
        margin: 0;
        font-size: 0.95rem;
    }

    .no-reviews {
        text-align: center;
        padding: 3rem 2rem;
        color: var(--text-muted);
    }

    .no-reviews i {
        font-size: 3.5rem;
        color: #d1d5db;
        margin-bottom: 1rem;
        display: block;
    }

    .no-reviews p {
        margin: 0;
        font-size: 1rem;
    }

    /* ===== SIDEBAR ===== */
    .news-section {
        position: sticky;
        top: 2rem;
    }

    .news-title {
        color: var(--text-dark);
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 1.5rem;
        padding-bottom: 0.75rem;
        border-bottom: 3px solid var(--primary-color);
        display: inline-block;
    }

    .news-item {
        background: white;
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 1rem;
        margin-bottom: 1rem;
        transition: all 0.3s ease;
        text-decoration: none;
        display: block;
    }

    .news-item:hover {
        transform: translateX(4px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        border-color: var(--primary-color);
    }

    .news-image {
        width: 90px;
        height: 90px;
        object-fit: cover;
        border-radius: 8px;
        flex-shrink: 0;
    }

    .news-content {
        flex: 1;
    }

    .news-content a {
        color: var(--text-dark);
        font-weight: 600;
        font-size: 0.95rem;
        line-height: 1.4;
        text-decoration: none;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        margin-bottom: 0.5rem;
    }

    .news-content a:hover {
        color: var(--primary-color);
    }

    .news-date {
        color: var(--text-muted);
        font-size: 0.85rem;
        display: block;
    }

    /* ===== ALERTS ===== */
    .alert-warning-custom {
        background: #fef3c7;
        border: 1px solid #fbbf24;
        border-radius: 12px;
        padding: 1.5rem;
        color: #92400e;
    }

    .alert-warning-custom i {
        color: #f59e0b;
    }

    /* ===== RESPONSIVE ===== */
    @@media (max-width: 991px) {
        .org-detail-container {
            padding: 2rem 0;
        }

        .news-section {
            position: static;
            margin-top: 3rem;
        }

        .org-detail-content {
            padding: 1.5rem;
        }

        .rating-number {
            font-size: 3rem;
        }

        .star-rating label {
            font-size: 2rem;
        }
    }

    @@media (max-width: 768px) {
        .org-image-detail {
            height: 200px;
        }

        .info-card {
            padding: 1.5rem;
        }

        .news-image {
            width: 70px;
            height: 70px;
        }

        .rating-number {
            font-size: 2.5rem;
        }

        .rating-stars {
            font-size: 1.5rem;
        }

        .review-form-card {
            padding: 1.5rem;
        }

        .star-rating label {
            font-size: 1.75rem;
        }

        .review-header {
            flex-direction: column;
            gap: 0.5rem;
        }

        .reviewer-avatar,
        .reviewer-placeholder {
            width: 40px;
            height: 40px;
            font-size: 1rem;
        }
    }
</style>

<div class="org-detail-container">
    <div class="container">
        <!-- Header -->
        <div class="detail-header">
            <h6>
                <i class="bi bi-building me-2"></i><strong>Chi tiết tổ chức</strong>
            </h6>
        </div>

        <div class="row">
            <!-- Organization Detail -->
            <div class="col-lg-8">
                @if (Model == null)
                {
                    <div class="alert-warning-custom">
                        <i class="bi bi-info-circle me-2"></i> Tổ chức không tồn tại.
                    </div>
                }
                else
                {
                    <!-- Main Info Card -->
                    <div class="org-main-card">
                        <div class="row g-0">
                            <div class="col-md-4">
                                <img src="@(!string.IsNullOrEmpty(Model.AvatarUrl) ? Model.AvatarUrl : "~/images/tochucxanhvn.jpg")"
                                     class="org-image-detail"
                                     alt="Ảnh tổ chức"
                                     onerror="this.src='~/images/default.png';" />
                            </div>
                            <div class="col-md-8">
                                <div class="org-detail-content">
                                    <h4>@Model.Name</h4>

                                    <div class="detail-info-item">
                                        <i class="bi bi-calendar-event"></i>
                                        <span>Ngày tham gia: <strong>@Model.JoinedDate.ToString("dd/MM/yyyy")</strong></span>
                                    </div>

                                    <div class="detail-info-item">
                                        <i class="bi bi-person-check"></i>
                                        <span>Xác minh: </span>
                                        @if (Model.Verified)
                                        {
                                            <span class="verify-badge verified">
                                                <i class="bi bi-check-circle-fill"></i> Đã xác minh
                                            </span>
                                        }
                                        else
                                        {
                                            <span class="verify-badge unverified">
                                                <i class="bi bi-exclamation-circle"></i> Chưa xác minh
                                            </span>
                                        }
                                    </div>

                                    <div class="detail-info-item">
                                        <i class="bi bi-envelope"></i>
                                        <span>Liên hệ: </span>
                                        <a href="mailto:@Model.ContactEmail">@Model.ContactEmail</a>
                                    </div>

                                    <div class="detail-info-item">
                                        <i class="bi bi-phone"></i>
                                        <span>Điện thoại: </span>
                                        <span>@Model.PhoneNumber</span>
                                    </div>

                                    @if (!string.IsNullOrEmpty(Model.Website))
                                    {
                                        <div class="detail-info-item">
                                            <i class="bi bi-globe"></i>
                                            <span>Website: </span>
                                            <a href="@Model.Website" target="_blank">@Model.Website</a>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Description Card -->
                    <div class="info-card">
                        <h6>
                            <i class="bi bi-info-circle me-2"></i>Giới thiệu về tổ chức
                        </h6>
                        <p class="text-break">@Model.Description</p>
                    </div>

                    <!-- Verification Documents Card -->
                    <div class="info-card">
                        <h6>
                            <i class="bi bi-file-earmark-text me-2"></i>Tài liệu xác minh
                        </h6>
                        @if (!string.IsNullOrEmpty(Model.VerificationDocsUrl))
                        {
                            <a href="@Model.VerificationDocsUrl" target="_blank" class="btn-document">
                                <i class="bi bi-file-earmark-text"></i>
                                Xem tài liệu
                            </a>
                        }
                        else
                        {
                            <p class="text-muted mb-0">Chưa có tài liệu xác minh.</p>
                        }
                    </div>

                    <!-- Statistics Card -->
                    <div class="info-card">
                        <h6>
                            <i class="bi bi-bar-chart me-2"></i>Thông tin thống kê
                        </h6>
                        <p><strong>Số thành viên:</strong> @Model.MemberCount</p>
                        <p><strong>Số sự kiện đã tổ chức:</strong> @Model.EventsOrganized</p>
                        <p><strong>Thành tựu:</strong> @Model.Achievements</p>
                    </div>

                    <!-- Rating & Review Section -->
                    <div class="info-card">
                        <h6>
                            <i class="bi bi-star-fill me-2"></i>Đánh giá từ cộng đồng
                        </h6>

                        <!-- Rating Summary -->
                        <div class="rating-summary">
                            <div class="rating-number">
                                @(Model.AverageRating?.ToString("0.0") ?? "0.0")
                            </div>
                            <div class="rating-stars">
                                @{
                                    var rating = Model.AverageRating ?? 0m;
                                    int full = (int)rating;
                                    bool hasHalf = rating - full >= 0.3m;
                                }
                                @for (int i = 1; i <= 5; i++)
                                {
                                    if (i <= full)
                                    {
                                        <i class="bi bi-star-fill"></i>
                                    }
                                    else if (i == full + 1 && hasHalf)
                                    {
                                        <i class="bi bi-star-half"></i>
                                    }
                                    else
                                    {
                                        <i class="bi bi-star"></i>
                                    }
                                }
                            </div>
                            <div class="rating-count">
                                Dựa trên @(Model.TotalReviews ?? 0) đánh giá
                            </div>
                        </div>

                        <!-- Review Form -->
                        @if (User.Identity?.IsAuthenticated == true && User.IsInRole("Volunteer"))
                        {
                            <div class="review-form-card">
                                <h6 class="mb-4">
                                    <i class="bi bi-pencil-square me-2"></i>Viết đánh giá của bạn
                                </h6>
                                <form asp-controller="Organization" asp-action="SubmitReview" asp-route-id="@Model.Id" method="post" id="reviewForm">
                                    @Html.AntiForgeryToken()
                                    <div class="mb-3">
                                        <label class="form-label fw-semibold">Chọn số sao:</label>
                                        <div class="star-rating">
                                            <input type="radio" name="rating" value="5" id="star5" required>
                                            <label for="star5"><i class="bi bi-star-fill"></i></label>
                                            <input type="radio" name="rating" value="4" id="star4">
                                            <label for="star4"><i class="bi bi-star-fill"></i></label>
                                            <input type="radio" name="rating" value="3" id="star3">
                                            <label for="star3"><i class="bi bi-star-fill"></i></label>
                                            <input type="radio" name="rating" value="2" id="star2">
                                            <label for="star2"><i class="bi bi-star-fill"></i></label>
                                            <input type="radio" name="rating" value="1" id="star1">
                                            <label for="star1"><i class="bi bi-star-fill"></i></label>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label fw-semibold">Nhận xét của bạn:</label>
                                        <textarea name="comment" class="review-textarea" placeholder="Chia sẻ trải nghiệm của bạn khi tham gia hoạt động cùng tổ chức này..." required minlength="10" maxlength="1000"></textarea>
                                    </div>
                                    <button type="submit" class="btn-submit-review">
                                        <i class="bi bi-send"></i> Gửi đánh giá
                                    </button>
                                </form>
                            </div>
                        }
                        else if (User.Identity?.IsAuthenticated == true)
                        {
                            <div class="alert alert-info rounded-3">
                                <i class="bi bi-info-circle me-2"></i>
                                Chỉ tài khoản <strong>tình nguyện viên</strong> mới được phép đánh giá tổ chức.
                            </div>
                        }
                        else
                        {
                            <div class="alert alert-light border rounded-3">
                                <i class="bi bi-person-plus me-2"></i>
                                <a href="/Identity/Account/Login?ReturnUrl=@Context.Request.Path" class="alert-link">
                                    Đăng nhập
                                </a> để viết đánh giá cho tổ chức này.
                            </div>
                        }

                        <!-- Reviews List -->
                        <div class="mt-5">
                            <h6 class="mb-4">
                                <i class="bi bi-chat-heart me-2"></i>
                                @(Model.Reviews?.Count ?? 0) đánh giá từ tình nguyện viên
                            </h6>

                            @if (Model.Reviews != null && Model.Reviews.Any())
{
    @* Biến đếm số lượng review *@
    int count = 0; 
    
    foreach (var review in Model.Reviews)
    {
        count++;
        @* Nếu là review thứ 6 trở đi thì thêm class hidden-review và ẩn đi *@
        <div class="review-item @(count > 5 ? "hidden-review" : "")" style="@(count > 5 ? "display:none" : "")">
            <div class="review-header">
                <div class="reviewer-info">
                    @if (!string.IsNullOrEmpty(review.AvatarUrl))
                    {
                        <img src="@review.AvatarUrl" class="reviewer-avatar" alt="@review.UserName">
                    }
                    else
                    {
                        <div class="reviewer-placeholder">
                            @(review.UserName?.Length > 0 ? review.UserName.Substring(0, 1).ToUpper() : "?")
                        </div>
                    }
                    <div class="reviewer-details">
                        <h6>@review.UserName</h6>
                        <div class="review-stars">
                            @for (int i = 1; i <= 5; i++)
                            {
                                <i class="bi bi-star@(i <= review.Rating ? "-fill" : "")"></i>
                            }
                        </div>
                    </div>
                </div>
                <div class="review-date">
                    @review.CreatedAt.ToString("dd/MM/yyyy")
                </div>
            </div>
            <p class="review-text">@review.Comment</p>
        </div>
    }

    @* Nút xem thêm: Chỉ hiện nếu tổng số review > 5 *@
    @if (Model.Reviews.Count > 5)
    {
        <div class="text-center mt-3" id="loadMoreContainer">
            <a href="javascript:void(0)" onclick="loadMoreReviews()" class="text-success fw-semibold text-decoration-none">
                Xem thêm @(Model.Reviews.Count - 5) đánh giá khác... <i class="bi bi-chevron-down"></i>
            </a>
        </div>
    }
}
else
{
    <div class="no-reviews">
        <i class="bi bi-chat-left-text"></i>
        <p>Chưa có đánh giá nào. Hãy là người đầu tiên chia sẻ trải nghiệm của bạn!</p>
    </div>
}
                        </div>
                    </div>

                    <!-- Back Button -->
                    <div class="mt-4">
                        <a asp-controller="Organization"
                           asp-action="Index"
                           class="btn-back">
                            <i class="bi bi-arrow-left me-2"></i>Quay lại danh sách
                        </a>
                    </div>
                }
            </div>

            <!-- Sidebar Events -->
            <div class="col-lg-4">
                <div class="news-section">
                    <h5 class="news-title">Các sự kiện của tổ chức</h5>

                    @if (Model?.Events != null && Model.Events.Any())
                    {
                        @foreach (var evt in Model.Events)
                        {
                            <a href="@Url.Action("Details", "Event", new { id = evt.Id })" class="news-item">
                                <div class="d-flex gap-3">
                                    <img src="@(!string.IsNullOrEmpty(evt.Images) ? evt.Images : "~/images/default-event.png")"
                                         class="news-image"
                                         alt="@evt.Title"
                                         onerror="this.src='~/images/default-event.png';" />
                                    <div class="news-content">
                                        <span style="color: var(--text-dark); font-weight: 600; font-size: 0.95rem; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; margin-bottom: 0.5rem;">
                                            @evt.Title
                                        </span>
                                        <small class="news-date">@evt.StartTime.ToString("dd/MM/yyyy")</small>
                                    </div>
                                </div>
                            </a>
                        }
                    }
                    else
                    {
                        <div class="text-center py-4">
                            <i class="bi bi-calendar-x" style="font-size: 2.5rem; color: #d1d5db;"></i>
                            <p class="text-muted mt-2 mb-0">Chưa có sự kiện nào.</p>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        // Star rating interaction
        document.addEventListener('DOMContentLoaded', function() {
            const starRating = document.querySelector('.star-rating');
            if (starRating) {
                const inputs = starRating.querySelectorAll('input');
                const labels = starRating.querySelectorAll('label');

                // Hover effect
                labels.forEach((label, index) => {
                    label.addEventListener('mouseover', function() {
                        const value = this.getAttribute('for').replace('star', '');
                        highlightStars(value);
                    });

                    label.addEventListener('click', function() {
                        const value = this.getAttribute('for').replace('star', '');
                        document.getElementById('star' + value).checked = true;
                        highlightStars(value);
                    });
                });

                // Reset on mouse leave
                starRating.addEventListener('mouseleave', function() {
                    const checked = starRating.querySelector('input:checked');
                    if (checked) {
                        highlightStars(checked.value);
                    } else {
                        resetStars();
                    }
                });

                // Initialize checked state
                const checkedInput = starRating.querySelector('input:checked');
                if (checkedInput) {
                    highlightStars(checkedInput.value);
                }

                function highlightStars(rating) {
                    labels.forEach((label, index) => {
                        const value = label.getAttribute('for').replace('star', '');
                        if (value <= rating) {
                            label.style.color = '#fbbf24';
                            label.style.transform = 'scale(1.1)';
                        } else {
                            label.style.color = '#d1d5db';
                            label.style.transform = 'scale(1)';
                        }
                    });
                }

                function resetStars() {
                    labels.forEach(label => {
                        label.style.color = '#d1d5db';
                        label.style.transform = 'scale(1)';
                    });
                }
            }

            // Form validation
            const reviewForm = document.getElementById('reviewForm');
            if (reviewForm) {
                reviewForm.addEventListener('submit', function(e) {
                    const rating = document.querySelector('input[name="rating"]:checked');
                    const comment = document.querySelector('textarea[name="comment"]');

                    if (!rating) {
                        e.preventDefault();
                        Swal.fire({
                            icon: 'warning',
                            title: 'Vui lòng chọn số sao',
                            text: 'Bạn cần chọn số sao để đánh giá',
                            confirmButtonColor: '#16a34a'
                        });
                        return false;
                    }

                    if (!comment.value || comment.value.trim().length < 10) {
                        e.preventDefault();
                        Swal.fire({
                            icon: 'warning',
                            title: 'Nhận xét quá ngắn',
                            text: 'Vui lòng viết ít nhất 10 ký tự',
                            confirmButtonColor: '#16a34a'
                        });
                        return false;
                    }
                });
            }
        });

        // SweetAlert notifications
        @if (TempData["Success"] != null)
        {
            <text>
            Swal.fire({
                icon: 'success',
                title: 'Thành công!',
                text: 'Đánh giá thành công',
                confirmButtonColor: '#16a34a',
                timer: 3000
            });
            </text>
        }

        @if (TempData["Warning"] != null)
        {
            <text>
            Swal.fire({
                icon: 'warning',
                title: 'Chú ý!',
                text: 'Bạn đã đánh giá tổ chức này rồi !',
                confirmButtonColor: '#f59e0b'
            });
            </text>
        }

        @if (TempData["Error"] != null)
        {
            <text>
            Swal.fire({
                icon: 'error',
                title: 'Lỗi!',
                text: '@TempData["Error"]',
                confirmButtonColor: '#dc2626'
            });
            </text>
        }

        // Hàm hiện thêm đánh giá
    function loadMoreReviews() {
        // Chọn tất cả các review đang bị ẩn
        var hiddenReviews = document.querySelectorAll('.hidden-review');
        
        // Hiện tất cả (hoặc bạn có thể hiện từng nhóm 5 cái nếu muốn)
        hiddenReviews.forEach(function(item) {
            item.style.display = 'block';
            item.classList.remove('hidden-review'); // Xóa class để đánh dấu đã hiện
        });

        // Ẩn nút "Xem thêm" sau khi đã hiện hết
        var btnContainer = document.getElementById('loadMoreContainer');
        if (btnContainer) {
            btnContainer.style.display = 'none';
        }
    }
    </script>
}